<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>System Monitor Dashboard</title>
    <meta http-equiv="refresh" content="5">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
        h1 { margin-bottom: 8px; }
        .wrap { display: grid; grid-template-columns: 1fr; gap: 24px; }
        .card { padding: 16px; border: 1px solid #ddd; border-radius: 8px; }
        ul.recs { list-style: none; padding-left: 0; }
        ul.recs li { padding: 8px 12px; margin: 6px 0; border-radius: 6px; }
        .level-ok { background: #e8f5e9; border: 1px solid #a5d6a7; }
        .level-warn { background: #fff8e1; border: 1px solid #ffe082; }
        .level-crit { background: #ffebee; border: 1px solid #ef9a9a; }
        .subtle { color: #666; font-size: 0.9rem; }
        .charts { display: grid; grid-template-columns: 1fr; gap: 24px; }
        @media (min-width: 1100px) {
            .charts { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <h1>System Monitor Dashboard</h1>
    <div class="subtle">Auto-refreshing every 5s â€¢ Latest samples shown</div>

    <div class="wrap">
        <div class="charts">
            <div class="card">
                <h2>CPU / RAM / Disk</h2>
                <div id="chart_usage"></div>
            </div>
            <div class="card">
                <h2>Network (per sample)</h2>
                <div id="chart_net"></div>
            </div>
        </div>

        <div class="card">
            <h2>Recommendations</h2>
            <ul class="recs">
                {% for r in recommendations %}
                    <li class="level-{{ r.level }}">{{ r.message }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <script>
        var usageTraces = {{ usageJSON | safe }};
        var netTraces = {{ netJSON | safe }};

        var usageLayout = {
            title: 'System Usage Over Time',
            xaxis: { title: 'Timestamp' },
            yaxis: { title: 'Usage %', rangemode: 'tozero', range: [0, 100] },
            margin: { t: 40 }
        };

        var netLayout = {
            title: 'Network MB per Sample',
            xaxis: { title: 'Timestamp' },
            yaxis: { title: 'MB since last sample', rangemode: 'tozero' },
            barmode: 'group',
            margin: { t: 40 }
        };

        Plotly.newPlot('chart_usage', usageTraces, usageLayout);
        Plotly.newPlot('chart_net', netTraces, netLayout);
    </script>
</body>
</html>
